var time=null;function jsonFormat(options){if(!options){return{}};var array=options.button||[];for(var i=0;i<array.length;i++){var item=array[i];if(!item.name){array.splice(i,1)}}options.button=array;return options}function VueInit(option,submitHandler){var extendsOptions=jsonFormat(option);var app=new Vue({el:'#app',data:{toastMsg:'',zindex:-1,subZindex:-1,nowItem:{},resultJson:JSON.stringify({menu:extendsOptions||{}},null,'  '),menu:extendsOptions,menuTypeList:[{value:'view',label:'跳转链接'},{value:'click',label:'事件推送'},{value:'miniprogram',label:'跳转小程序'},],},methods:{toast:function(msg){clearTimeout(time);this.toastMsg=msg;var that=this;time=setTimeout(function(){that.toastMsg=''},2000)},addMenuHandler:function(type){if(type==0){this.menu.button.push({name:'菜单名称',type:'view',})}else if(type==1){var item={name:'子菜单名称',type:'view',};if(this.menu.button[this.zindex].hasOwnProperty('sub_button')){this.menu.button[this.zindex].sub_button.push(item);this.nowItem=deepClone(this.menu.button[this.zindex])}else{Vue.set(this.menu.button[this.zindex],'sub_button',[item]);Vue.set(this.nowItem,'sub_button',[item])}Vue.delete(this.menu.button[this.zindex],'url');Vue.delete(this.menu.button[this.zindex],'type');Vue.delete(this.menu.button[this.zindex],'appid')}},removeMenuHandler:function(){if(this.subZindex<0){this.menu.button.splice(this.zindex,1);this.zindex=-1;this.nowItem={}}else{this.menu.button[this.zindex].sub_button.splice(this.subZindex,1);this.subZindex=-1;this.nowItem=deepClone(this.menu.button[this.zindex])}},selectedMenuItem:function(value){this.zindex=value;this.nowItem=deepClone(this.menu.button[value]);this.subZindex=-1},selectedSubMenuItem:function(value){this.subZindex=value;this.nowItem=deepClone(this.menu.button[this.zindex].sub_button[value],)},confirmEditor:function(){if(this.nowItem.name==''){this.toast('请填写菜单名称');return false}else{if(this.nowItem.type=='view'&&!this.nowItem.url){this.toast('请输入跳转链接');return false}else if(this.nowItem.type=='click'&&!this.nowItem.key){this.toast('请输入推送的内容');return false}else if(this.nowItem.type=='miniprogram'){if(!this.nowItem.pagepath){this.toast('请输入小程序路径');return false}else if(!this.nowItem.url){this.toast('请输入备用链接');return false}else if(!this.nowItem.appid){this.toast('请输入AppId');return false}}}if(this.subZindex<0){this.menu.button.splice(this.zindex,1,this.nowItem)}else{this.menu.button[this.zindex].sub_button.splice(this.subZindex,1,this.nowItem,)};this.resultJson=JSON.stringify({menu:this.menu},null,'  ');this.toast('修改成功')},saveHandler:function(event){var flag=false;function verification(menuArr){for(var i=0;i<menuArr.length;i++){var nowItem=menuArr[i];if(nowItem.name==''){alert('请完善菜单名称');flag=true;break}else if(nowItem.sub_button&&nowItem.sub_button.length){verification(nowItem.sub_button)}else{if(nowItem.type=='view'&&!nowItem.url){alert('请输入 ['+nowItem.name+'] 跳转链接');flag=true;break}else if(nowItem.type=='click'&&!nowItem.key){alert('请输入 ['+nowItem.name+'] 推送的内容');flag=true;break}else if(nowItem.type=='miniprogram'){if(!nowItem.pagepath){alert('请输入 ['+nowItem.name+'] 小程序路径');flag=true;break}else if(!nowItem.url){alert('请输入 ['+nowItem.name+'] 备用链接');flag=true;break}else if(!nowItem.appid){alert('请输入 ['+nowItem.name+'] AppId');flag=true;break}}}}return flag}if(verification(this.menu.button)){event&&event.preventDefault()}submitHandler&&submitHandler({menu:this.menu})},selectedMenuType:function(value){var item={type:value,name:this.nowItem.name,};if(value=='click'){item.key=this.nowItem.url||''}else if(value=='view'){item.url=this.nowItem.url||''}else{item.appid='';item.url=this.nowItem.url||'';item.pagepath=''}this.nowItem=item},},})}function deepClone(data){var obj;if(isArray(data)){obj=[]}else if(isObject(data)){obj={}}else{return data}if(isArray(data)){for(var i=0,len=data.length;i<len;i++){obj.push(deepClone(data[i]))}}else if(isObject(data)){for(var key in data){obj[key]=deepClone(data[key])}}return obj}function isArray(arg){return Object.prototype.toString.call(arg)==='[object Array]'}function isObject(arg){return Object.prototype.toString.call(arg)==='[object Object]'}